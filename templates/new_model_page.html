<!-- <!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synthetic Blood Demand Forecast</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
            margin-top: 50px;
        }
        .card {
            padding: 2rem;
            border: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #resultsTable {
            margin-top: 2rem;
        }
        .spinner-border {
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h2 class="text-center mb-4">Blood Demand Forecast Model</h2>
            <p class="text-center text-muted">This model predicts the total blood demand based on synthetic historical data including population, temperature, and hospital admissions.</p>
            <hr>
            <form id="predictForm">
                <div class="mb-3">
                    <label for="horizon_days" class="form-label"><b>Days to Forecast</b></label>
                    <input type="number" class="form-control" id="horizon_days" name="horizon_days" value="14" min="1" max="90" required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <span id="buttonSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Forecast Demand
                    </button>
                </div>
            </form>
            <div id="results" class="mt-4"></div>
        </div>
    </div>

    <script>
        document.getElementById('predictForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const horizonDays = document.getElementById('horizon_days').value;
            const resultsDiv = document.getElementById('results');
            const spinner = document.getElementById('buttonSpinner');
            const button = this.querySelector('button');

            // Clear previous results and show spinner
            resultsDiv.innerHTML = '';
            spinner.style.display = 'inline-block';
            button.disabled = true;

            try {
                const response = await fetch('/forecast', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ horizon_days: horizonDays })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.forecasts && data.forecasts.length > 0) {
                    let tableHtml = `
                        <h4 class="mt-4">Forecasted Demand</h4>
                        <table class="table table-striped table-hover" id="resultsTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>Date</th>
                                    <th>Predicted Units</th>
                                </tr>
                            </thead>
                            <tbody>`;
                    
                    data.forecasts.forEach(row => {
                        tableHtml += `
                            <tr>
                                <td>${row.date}</td>
                                <td>${row.forecast_units}</td>
                            </tr>`;
                    });

                    tableHtml += '</tbody></table>';
                    resultsDiv.innerHTML = tableHtml;
                } else {
                     resultsDiv.innerHTML = '<p class="text-center text-danger">No forecast data returned.</p>';
                }

            } catch (error) {
                resultsDiv.innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${error.message}</div>`;
            } finally {
                // Hide spinner and re-enable button
                spinner.style.display = 'none';
                button.disabled = false;
            }
        });
    </script>
</body>
</html> 




<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Synthetic Blood Demand Forecast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <link rel="shortcut icon" href="{{ url_for('static', filename='resources/logopin.png') }}" >
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-red: #9d2020;
      --dark-red: #9c1c1c;
      --light-red: #ef5350;
      --black: #121212;
      --dark-gray: #1e1e1e;
      --light-yellow: #ffffc5;
      --pink: #f8bbd0;
      --white: #ffffff;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body { 
      font-family: 'Poppins', system-ui, -apple-system, sans-serif; 
      color: var(--white); 
      background: var(--black);
      min-height: 100vh;
      display: flex;
    }
    
    /* Sidebar Navigation */
    .sidebar {
      width: 280px;
      background: var(--dark-gray);
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      padding: 20px 0;
      box-shadow: 3px 0 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .sidebar.collapsed {
      width: 70px;
    }
    
    .logo-area {
      display: flex;
      align-items: center;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 20px;
    }
    
    .logo {
      width: 40px;
      height: 40px;
      margin-right: 15px;
    }
    
    .logo-text {
      font-size: 22px;
      font-weight: 700;
      color: var(--primary-red);
    }
    
    .sidebar.collapsed .logo-text {
      display: none;
    }
    
    .hamburger-btn {
      position: absolute;
      right: 15px;
      top: 25px;
      background: none;
      border: none;
      color: var(--white);
      font-size: 24px;
      cursor: pointer;
      display: none; /* Hide the hamburger button */
    }
    
    .nav-links {
      list-style: none;
      padding: 0 15px;
    }
    
    .nav-links li {
      margin-bottom: 10px;
    }
    
    .nav-links a {
      display: flex;
      align-items: center;
      padding: 12px 15px;
      text-decoration: none;
      color: var(--white);
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .nav-links a:hover, .nav-links a.active {
      background: var(--primary-red);
    }
    
    .nav-links i {
      margin-right: 15px;
      font-size: 20px;
    }
    
    .sidebar.collapsed .nav-links span {
      display: none;
    }
    
    .sidebar.collapsed .nav-links i {
      margin-right: 0;
    }
    
    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 30px;
      transition: all 0.3s ease;
    }
    
    .main-content.expanded {
      margin-left: 70px;
    }
    
    .page-header {
      background: linear-gradient(to right, var(--dark-red), var(--primary-red));
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      text-align: center;
    }
    
    .page-header h1 {
      font-size: 32px;
      margin-bottom: 10px;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
    }
    
    .page-header p {
      font-size: 18px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    /* Card Styles */
    .card {
      background: var(--dark-gray);
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--primary-red);
    }
    
    .card h3 {
      color: var(--primary-red);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Form Styles */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      color: var(--light-yellow);
      font-weight: 500;
    }
    
    input, select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      color: var(--white);
      font-family: 'Poppins', sans-serif;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: var(--primary-red);
      box-shadow: 0 0 0 2px rgba(211, 47, 47, 0.2);
    }
    
    button[type="submit"] {
      background: linear-gradient(to right, var(--dark-red), var(--primary-red));
      color: white;
      border: none;
      padding: 14px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 10px;
    }
    
    button[type="submit"]:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    /* Status Message */
    .status {
      padding: 15px;
      border-radius: 8px;
      margin: 20px 0;
      background: rgba(255, 255, 255, 0.1);
      text-align: center;
    }
    
    /* Table Styles */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      overflow: hidden;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    th {
      background: var(--primary-red);
      color: white;
      font-weight: 600;
    }
    
    tr:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    /* Badge Styles */
    .badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 12px;
      display: inline-block;
      text-align: center;
    }
    
    .SAFE {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
    }
    
    .WARNING {
      background: rgba(255, 193, 7, 0.2);
      color: #ffc107;
    }
    
    .CRITICAL {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
    }
    
    /* Button Styles */
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      border: none;
      font-family: 'Poppins', sans-serif;
    }
    
    .btn-primary {
      background: var(--primary-red);
      color: white;
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: var(--white);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    /* Chart Container */
    .chart-container {
      height: 400px;
      margin-top: 30px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
      padding: 20px;
    }
    
    /* Responsive Design */
    @media (max-width: 992px) {
      .sidebar {
        width: 70px;
      }
      
      .sidebar .logo-text,
      .sidebar .nav-links span {
        display: none;
      }
      
      .sidebar .nav-links i {
        margin-right: 0;
      }
      
      .main-content {
        margin-left: 70px;
      }
      
      .grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .main-content {
        margin-left: 0;
        padding: 20px;
      }
      
      .sidebar {
        left: -280px;
      }
      
      .sidebar.active {
        left: 0;
      }
      
      .mobile-menu-btn {
        display: block;
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 999;
        background: var(--primary-red);
        color: white;
        border: none;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }
      
      .page-header h1 {
        font-size: 28px;
      }
      
      .page-header p {
        font-size: 16px;
      }
    }

    body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
        }

        .container {
            max-width: 1000px; /* Wider container for a better layout */
            margin-top: 40px;
            margin-bottom: 40px;
        }

        /* --- Modern Card Decorations --- */
        .card {
            background-color: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 12px; /* Softer corners */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px); /* Frosted glass effect */
            margin-bottom: 2rem;
            padding: 2.5rem;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px); /* Subtle lift effect on hover */
        }
        
        /* --- Typography & Elements --- */
        h2, h3, h4, h5 {
            font-weight: 500;
            color: #1a253c;
        }

        .spinner-border {
            display: none;
        }

        .graph-container img {
            max-width: 100%;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 5px;
        }
        
        .btn-primary {
            background-color: #0d6efd;
            border: none;
            padding: 12px 20px;
            font-size: 1.1rem;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #0a58ca;
        }
    
  </style>
</head>
<body>
  
  <div class="sidebar" id="sidebar">
    <div class="logo-area">
      <img src="{{ url_for('static', filename='resources/logopin.png') }}" alt="HemoFlow Logo" class="logo">
      <div class="logo-text">HemoFlow</div>
    </div>
    
    <ul class="nav-links">
      <li><a href="http://127.0.0.1:5000/" class="active"><i class="fas fa-home"></i> <span>Home</span></a></li>
      <li><a href="http://127.0.0.1:5000/predict-form"><i class="fas fa-tint"></i> <span>Inventory Manager</span></a></li>
      <li><a href="#"><i class="fas fa-tint"></i> <span>Blood Inventory</span></a></li>
      <li><a href="#"><i class="fas fa-chart-line"></i> <span>Forecasts</span></a></li>
      <li><a href="#"><i class="fas fa-hospital"></i> <span>Hospitals</span></a></li>
      <li><a href="#"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
      <li><a href="#"><i class="fas fa-question-circle"></i> <span>Help</span></a></li>
    </ul>
  </div>
  

  <div class="main-content" id="mainContent">
    <div class="page-header">
      <h1>Blood Demand Forecast Model</h1>
      <p>This model predicts the total blood demand based on synthetic historical data including population, temperature, and hospital admissions.</p>
    </div>

     <form id="predictForm">
                <div class="mb-3">
                    <label for="horizon_days" class="form-label"><b>Days to Forecast</b></label>
                    <input type="number" class="form-control" id="horizon_days" name="horizon_days" value="14" min="1" max="90" required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <span id="buttonSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Forecast Demand
                    </button>
                </div>
            </form>
            <div id="results" class="mt-4"></div>
        </div>
    </div>

    <script>
        document.getElementById('predictForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const horizonDays = document.getElementById('horizon_days').value;
            const resultsDiv = document.getElementById('results');
            const spinner = document.getElementById('buttonSpinner');
            const button = this.querySelector('button');

            // Clear previous results and show spinner
            resultsDiv.innerHTML = '';
            spinner.style.display = 'inline-block';
            button.disabled = true;

            try {
                const response = await fetch('/forecast', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ horizon_days: horizonDays })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.forecasts && data.forecasts.length > 0) {
                    let tableHtml = `
                        <h4 class="mt-4">Forecasted Demand</h4>
                        <table class="table table-striped table-hover" id="resultsTable">
                            <thead class="table-dark">
                                <tr>
                                    <th>Date</th>
                                    <th>Predicted Units</th>
                                </tr>
                            </thead>
                            <tbody>`;
                    
                    data.forecasts.forEach(row => {
                        tableHtml += `
                            <tr>
                                <td>${row.date}</td>
                                <td>${row.forecast_units}</td>
                            </tr>`;
                    });

                    tableHtml += '</tbody></table>';
                    resultsDiv.innerHTML = tableHtml;
                } else {
                     resultsDiv.innerHTML = '<p class="text-center text-danger">No forecast data returned.</p>';
                }

            } catch (error) {
                resultsDiv.innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${error.message}</div>`;
            } finally {
                // Hide spinner and re-enable button
                spinner.style.display = 'none';
                button.disabled = false;
            }
        });
    </script> -->

    <!-- <form id="predictForm">
                <div class="mb-3">
                    <label for="horizon_days" class="form-label"><b>Days to Forecast</b></label>
                    <input type="number" class="form-control" id="horizon_days" name="horizon_days" value="14" min="1" max="90" required>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <span id="buttonSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Forecast Demand
                    </button>
                </div>
            </form>
        </div>

        <div class="card" id="resultsCard" style="display: none;">
             <h4 class="text-center">Future Demand Forecast</h4>
             <canvas id="forecastChart"></canvas>
             <div id="resultsTable" class="mt-4"></div>
        </div>

        <div class="card">
            <h3 class="text-center mb-4">Model Analysis</h3>
            <div class="row">
                <div class="col-md-12 mb-4">
                    <h5 class="text-center">What Factors Are Most Important?</h5>
                    <div class="graph-container text-center">
                        <img src="/static/feature_importance.png?v=<%= new Date().getTime() %>" alt="Feature Importance Chart">
                    </div>
                </div>
                <hr>
                <div class="col-md-12 mt-3">
                     <h5 class="text-center">How Accurate Is the Model?</h5>
                    <div class="graph-container text-center">
                         <img src="/static/forecast_vs_actuals.png?v=<%= new Date().getTime() %>" alt="Actual vs. Predicted Chart">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let forecastChartInstance = null; // To hold the chart object

        document.getElementById('predictForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const horizonDays = document.getElementById('horizon_days').value;
            const resultsCard = document.getElementById('resultsCard');
            const resultsTableDiv = document.getElementById('resultsTable');
            const spinner = document.getElementById('buttonSpinner');
            const button = this.querySelector('button');

            resultsTableDiv.innerHTML = '';
            spinner.style.display = 'inline-block';
            button.disabled = true;

            try {
                const response = await fetch('/forecast', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ horizon_days: horizonDays })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                
                // Show the results card
                resultsCard.style.display = 'block';
                
                // ✨ NEW: Render the dynamic forecast chart
                const labels = data.forecasts.map(row => row.date);
                const forecastData = data.forecasts.map(row => row.forecast_units);
                const ctx = document.getElementById('forecastChart').getContext('2d');

                if (forecastChartInstance) {
                    forecastChartInstance.destroy(); // Clear old chart before drawing new one
                }

                forecastChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Forecasted Demand (Units)',
                            data: forecastData,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: true, text: 'Future Demand Forecast' }
                        }
                    }
                });

                // (Optional) Display results as a table as well
                let tableHtml = `<h5 class="mt-4 text-center">Forecast Data</h5><table class="table table-striped table-hover">
                                 <thead class="table-dark"><tr><th>Date</th><th>Predicted Units</th></tr></thead><tbody>`;
                data.forecasts.forEach(row => {
                    tableHtml += `<tr><td>${row.date}</td><td>${row.forecast_units}</td></tr>`;
                });
                tableHtml += '</tbody></table>';
                resultsTableDiv.innerHTML = tableHtml;

            } catch (error) {
                resultsCard.style.display = 'block'; // Show card to display error
                resultsTableDiv.innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${error.message}</div>`;
            } finally {
                spinner.style.display = 'none';
                button.disabled = false;
            }
        });
    </script>
    



     <form id="predictForm">
                <div class="mb-3">
                    <label for="horizon_days" class="form-label"><b>Number of Days to Forecast</b></label>
                    <input type="number" class="form-control" id="horizon_days" name="horizon_days" value="14" min="1" max="90" required>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <span id="buttonSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Generate Forecast
                    </button>
                </div>
            </form>
        </div>

        <div class="card" id="resultsCard" style="display: none;">
             <h4 class="text-center mb-4">Future Demand Forecast</h4>
             <canvas id="forecastChart" style="max-height: 400px;"></canvas>
             <div id="resultsTable" class="mt-4"></div>
        </div>

        <div class="card">
            <h3 class="text-center mb-4">Model Analysis & Insights</h3>
            <div class="row g-5 align-items-center">
                <div class="col-lg-12">
                    <h5 class="text-center mb-3">Which factors are the most predictive?</h5>
                    <div class="graph-container text-center">
                        <img src="/static/feature_importance.png?v=<%= new Date().getTime() %>" alt="Feature Importance Chart">
                    </div>
                </div>
                <div class="col-lg-12">
                    <hr class="my-4">
                     <h5 class="text-center mb-3">How accurate is the model on historical data?</h5>
                    <div class="graph-container text-center">
                         <img src="/static/forecast_vs_actuals.png?v=<%= new Date().getTime() %>" alt="Actual vs. Predicted Chart">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let forecastChartInstance = null; // To hold the chart object

        document.getElementById('predictForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const horizonDays = document.getElementById('horizon_days').value;
            const resultsCard = document.getElementById('resultsCard');
            const resultsTableDiv = document.getElementById('resultsTable');
            const spinner = document.getElementById('buttonSpinner');
            const button = this.querySelector('button');

            resultsTableDiv.innerHTML = '';
            spinner.style.display = 'inline-block';
            button.disabled = true;

            try {
                const response = await fetch('/forecast', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ horizon_days: horizonDays })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
                }

                const data = await response.json();
                
                resultsCard.style.display = 'block';
                
                const labels = data.forecasts.map(row => row.date);
                const forecastData = data.forecasts.map(row => row.forecast_units);
                const ctx = document.getElementById('forecastChart').getContext('2d');

                if (forecastChartInstance) {
                    forecastChartInstance.destroy();
                }

                forecastChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Forecasted Demand (Units)',
                            data: forecastData,
                            borderColor: '#0d6efd',
                            backgroundColor: 'rgba(13, 110, 253, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: { display: false }
                        }
                    }
                });

                let tableHtml = `<div class="table-responsive mt-4"><table class="table table-striped table-hover">
                                 <thead class="table-dark"><tr><th>Date</th><th>Predicted Units</th></tr></thead><tbody>`;
                data.forecasts.forEach(row => {
                    tableHtml += `<tr><td>${row.date}</td><td>${row.forecast_units}</td></tr>`;
                });
                tableHtml += '</tbody></table></div>';
                resultsTableDiv.innerHTML = tableHtml;

            } catch (error) {
                resultsCard.style.display = 'block';
                resultsTableDiv.innerHTML = `<div class="alert alert-danger"><strong>Error:</strong> ${error.message}</div>`;
            } finally {
                spinner.style.display = 'none';
                button.disabled = false;
            }
        });
    </script>
    

  
</body>
</html> -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HemoFlow - City-Wide Demand Forecaster</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="{{ url_for('static', filename='resources/logopin.png') }}" >
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-red: #9d2020;
      --dark-red: #9c1c1c;
      --light-red: #ef5350;
      --black: #121212;
      --dark-gray: #1e1e1e;
      --light-yellow: #ffffc5;
      --pink: #f8bbd0;
      --white: #ffffff;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Poppins', system-ui, -apple-system, sans-serif; 
      color: var(--white); 
      background: var(--black);
      min-height: 100vh;
      display: flex;
    }
    .sidebar {
      width: 280px; background: var(--dark-gray); height: 100vh;
      position: fixed; left: 0; top: 0; padding: 20px 0;
      box-shadow: 3px 0 10px rgba(0, 0, 0, 0.2); z-index: 1000;
    }
    .logo-area {
      display: flex; align-items: center; padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 20px;
    }
    .logo { width: 40px; height: 40px; margin-right: 15px; }
    .logo-text { font-size: 22px; font-weight: 700; color: var(--primary-red); }
    .nav-links { list-style: none; padding: 0 15px; }
    .nav-links li { margin-bottom: 10px; }
    .nav-links a {
      display: flex; align-items: center; padding: 12px 15px;
      text-decoration: none; color: var(--white); border-radius: 8px;
      transition: all 0.3s ease;
    }
    .nav-links a:hover, .nav-links a.active { background: var(--primary-red); }
    .nav-links i { margin-right: 15px; font-size: 20px; }
    .main-content { flex: 1; margin-left: 280px; padding: 30px; transition: all 0.3s ease; }
    .page-header {
      background: linear-gradient(to right, var(--dark-red), var(--primary-red));
      padding: 25px; border-radius: 12px; margin-bottom: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); text-align: center;
    }
    .page-header h1 { font-size: 32px; margin-bottom: 10px; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3); }
    .page-header p { font-size: 18px; max-width: 800px; margin: 0 auto; }
    .card {
      background: var(--dark-gray); border-radius: 12px; padding: 25px;
      margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--primary-red);
    }
    .card h3 {
      color: var(--primary-red); margin-bottom: 20px; padding-bottom: 10px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    label { display: block; margin-bottom: 8px; color: var(--light-yellow); font-weight: 500; }
    input {
      width: 100%; padding: 12px 15px; border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px; background: rgba(0, 0, 0, 0.2); color: var(--white);
      font-family: 'Poppins', sans-serif;
    }
    input:focus {
      outline: none; border-color: var(--primary-red);
      box-shadow: 0 0 0 2px rgba(211, 47, 47, 0.2);
    }
    .btn-submit {
      background: linear-gradient(to right, var(--dark-red), var(--primary-red));
      color: white; border: none; padding: 14px 25px; border-radius: 8px;
      cursor: pointer; font-weight: 600; font-family: 'Poppins', sans-serif;
      transition: all 0.3s ease; width: 100%; margin-top: 10px; font-size: 1.1rem;
    }
    .btn-submit:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
    .spinner-border { display: none; }
    .graph-container img { max-width: 100%; border-radius: 8px; background: #2a2a2a; padding: 10px; }
    .chart-container { height: 400px; margin-top: 30px; }
    .table-responsive { overflow-x: auto; }
    table {
        width: 100%; border-collapse: collapse; margin: 20px 0;
        background: rgba(0, 0, 0, 0.2); border-radius: 8px; overflow: hidden;
    }
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
    th { background: var(--primary-red); color: white; font-weight: 600; }
    tr:hover { background: rgba(255, 255, 255, 0.05); }
  </style>
</head>
<body>
  <div class="sidebar" id="sidebar">
    <div class="logo-area">
      <img src="{{ url_for('static', filename='resources/logopin.png') }}" alt="HemoFlow Logo" class="logo">
      <div class="logo-text">HemoFlow</div>
    </div>
    
    <ul class="nav-links">
        <li><a href="http://127.0.0.1:5000/"><i class="fas fa-home"></i> <span>Home</span></a></li>
        <li><a href="http://127.0.0.1:5000/predict-form" class="active"><i class="fas fa-chart-line"></i> <span>Inventory Manager</span></a></li>
        <li><a href="#"><i class="fas fa-tint"></i> <span>Blood Inventory</span></a></li>
        <li><a href="#"><i class="fas fa-hospital"></i> <span>Hospitals</span></a></li>
        <li><a href="#"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
        <li><a href="#"><i class="fas fa-question-circle"></i> <span>Help</span></a></li>
    </ul>
  </div>
  
  <div class="main-content" id="mainContent">
    <div class="page-header">
      <h1>City-Wide Blood Demand Forecaster</h1>
      <p>A strategic AI model to predict regional blood demand using population, weather, and historical data.</p>
    </div>
    
    <div class="card">
      <h3>Forecast Parameters</h3>
      <form id="predictForm">
          <div class="form-group">
            <label for="horizon_days">Number of Days to Forecast</label>
            <input type="number" id="horizon_days" name="horizon_days" value="14" min="1" max="90" required>
          </div>
          <button type="submit" class="btn-submit">
              <span id="buttonSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Generate Forecast
          </button>
      </form>
    </div>

    <div id="resultsCard" class="card" style="display:none">
      <h3>Forecast Results</h3>
      <div class="chart-container">
        <canvas id="forecastChart"></canvas>
      </div>
      <div id="resultsTable" class="table-responsive mt-4"></div>
    </div>

    <div class="card">
        <h3>Model Analysis & Insights</h3>
        <div class="row g-5 align-items-center">
            <div class="col-lg-12">
                <h5 style="text-align: center; margin-bottom: 15px; color: var(--light-yellow);">Which factors are the most predictive?</h5>
                <div class="graph-container text-center">
                    <img src="/static/feature_importance.png" alt="Feature Importance Chart">
                </div>
            </div>
            <div class="col-lg-12">
                <hr style="margin: 30px 0; border-color: rgba(255,255,255,0.1);">
                 <h5 style="text-align: center; margin-bottom: 15px; color: var(--light-yellow);">How accurate is the model on historical data?</h5>
                <div class="graph-container text-center">
                     <img src="/static/forecast_vs_actuals.png" alt="Actual vs. Predicted Chart">
                </div>
            </div>
        </div>
    </div>
  </div>

  <script>
    let forecastChartInstance = null;

    document.getElementById('predictForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const horizonDays = document.getElementById('horizon_days').value;
        const resultsCard = document.getElementById('resultsCard');
        const resultsTableDiv = document.getElementById('resultsTable');
        const spinner = document.getElementById('buttonSpinner');
        const button = this.querySelector('button');
        resultsTableDiv.innerHTML = '';
        spinner.style.display = 'inline-block';
        button.disabled = true;

        try {
            const response = await fetch('/forecast', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ horizon_days: horizonDays })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
            }

            const data = await response.json();
            resultsCard.style.display = 'block';
            
            const labels = data.forecasts.map(row => row.date);
            const forecastData = data.forecasts.map(row => row.forecast_units);
            const ctx = document.getElementById('forecastChart').getContext('2d');

            if (forecastChartInstance) {
                forecastChartInstance.destroy();
            }

            forecastChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Forecasted Demand (Units)',
                        data: forecastData,
                        borderColor: 'var(--primary-red)',
                        backgroundColor: 'rgba(157, 32, 32, 0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                      x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white' } },
                      y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white' } }
                    },
                    plugins: { legend: { labels: { color: 'white' } } }
                }
            });

            let tableHtml = `<table><thead><tr><th>Date</th><th>Predicted Units</th></tr></thead><tbody>`;
            data.forecasts.forEach(row => {
                tableHtml += `<tr><td>${row.date}</td><td>${row.forecast_units.toFixed(2)}</td></tr>`;
            });
            tableHtml += '</tbody></table>';
            resultsTableDiv.innerHTML = tableHtml;

        } catch (error) {
            resultsCard.style.display = 'block';
            resultsTableDiv.innerHTML = `<p style="color: var(--light-red); text-align: center;"><strong>Error:</strong> ${error.message}</p>`;
        } finally {
            spinner.style.display = 'none';
            button.disabled = false;
        }
    });
  </script>
</body>
</html>